<source>
  type tail
  path /var/log/containers/*.log
  pos_file /var/log/kube-containers.log.pos
  time_format %Y-%m-%dT%H:%M:%S
  tag kubernetes.*
  format json_in_json
  read_from_head false
</source>

<filter kubernetes.**>
  type kubernetes_metadata
</filter>

<source>
  type systemd
  pos_file /var/log/systemd.pos
  tag systemd
  strip_underscores true
</source>

# Do not directly collect fluentd's own logs to avoid infinite loops.
<match fluent.**>
  type null
</match>

<match **>
  type aws-elasticsearch-service
  logstash_format true
  include_tag_key true
  tag_key "@log_name"
  log_level info

  flush_interval 5s
  buffer_chunk_limit 2M
  # Cap buffer memory usage to 2MiB/chunk * 32 chunks = 64 MiB
  buffer_queue_limit 32
  max_retry_wait 30
  # For Amazon Elasticsearch Service this must be set to false as nodes are not returned correctly
  reload_connections false

  <endpoint>
    # TODO Fill these out with your own values
    url "<YOUR AWS Elasticsearch Service URL>"
    region "<YOUR AWS Region>"
  </endpoint>
</match>
